(()=>{function Z(e){return e&&e.__esModule?e.default:e}var z=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{},P={},N={},_=z.parcelRequireeadf;_==null&&(_=function(e){if(e in P)return P[e].exports;if(e in N){var r=N[e];delete N[e];var t={id:e,exports:{}};return P[e]=t,r.call(t.exports,t,t.exports),t.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n},_.register=function(r,t){N[r]=t},z.parcelRequireeadf=_),_.register("3d6g0",function(e,r){(function(t,n){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],n);else{var s;n(e)}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:this,function(t){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const n="The message port closed before a response was received.",s=o=>{const a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class l extends WeakMap{constructor(c,d){super(d),this.createItem=c}get(c){return this.has(c)||this.set(c,this.createItem(c)),super.get(c)}}const b=i=>i&&typeof i=="object"&&typeof i.then=="function",u=(i,c)=>(...d)=>{o.runtime.lastError?i.reject(new Error(o.runtime.lastError.message)):c.singleCallbackArg||d.length<=1&&c.singleCallbackArg!==!1?i.resolve(d[0]):i.resolve(d)},A=i=>i==1?"argument":"arguments",M=(i,c)=>function(m,...x){if(x.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${A(c.minArgs)} for ${i}(), got ${x.length}`);if(x.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${A(c.maxArgs)} for ${i}(), got ${x.length}`);return new Promise(($,w)=>{if(c.fallbackToNoCallback)try{m[i](...x,u({resolve:$,reject:w},c))}catch(g){console.warn(`${i} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),m[i](...x),c.fallbackToNoCallback=!1,c.noCallback=!0,$()}else c.noCallback?(m[i](...x),$()):m[i](...x,u({resolve:$,reject:w},c))})},I=(i,c,d)=>new Proxy(c,{apply(m,x,$){return d.call(x,i,...$)}});let O=Function.call.bind(Object.prototype.hasOwnProperty);const k=(i,c={},d={})=>{let m=Object.create(null),x={has(w,g){return g in i||g in m},get(w,g,y){if(g in m)return m[g];if(!(g in i))return;let h=i[g];if(typeof h=="function")if(typeof c[g]=="function")h=I(i,i[g],c[g]);else if(O(d,g)){let E=M(g,d[g]);h=I(i,i[g],E)}else h=h.bind(i);else if(typeof h=="object"&&h!==null&&(O(c,g)||O(d,g)))h=k(h,c[g],d[g]);else if(O(d,"*"))h=k(h,c[g],d["*"]);else return Object.defineProperty(m,g,{configurable:!0,enumerable:!0,get(){return i[g]},set(E){i[g]=E}}),h;return m[g]=h,h},set(w,g,y,h){return g in m?m[g]=y:i[g]=y,!0},defineProperty(w,g,y){return Reflect.defineProperty(m,g,y)},deleteProperty(w,g){return Reflect.deleteProperty(m,g)}},$=Object.create(i);return new Proxy($,x)},j=i=>({addListener(c,d,...m){c.addListener(i.get(d),...m)},hasListener(c,d){return c.hasListener(i.get(d))},removeListener(c,d){c.removeListener(i.get(d))}}),V=new l(i=>typeof i!="function"?i:function(d){const m=k(d,{},{getContent:{minArgs:0,maxArgs:0}});i(m)}),J=new l(i=>typeof i!="function"?i:function(d,m,x){let $=!1,w,g=new Promise(F=>{w=function(C){$=!0,F(C)}}),y;try{y=i(d,m,w)}catch(F){y=Promise.reject(F)}const h=y!==!0&&b(y);if(y!==!0&&!h&&!$)return!1;const E=F=>{F.then(C=>{x(C)},C=>{let q;C&&(C instanceof Error||typeof C.message=="string")?q=C.message:q="An unexpected error occurred",x({__mozWebExtensionPolyfillReject__:!0,message:q})}).catch(C=>{console.error("Failed to send onMessage rejected reply",C)})};return E(h?y:g),!0}),ze=({reject:i,resolve:c},d)=>{o.runtime.lastError?o.runtime.lastError.message===n?c():i(new Error(o.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?i(new Error(d.message)):c(d)},ye=(i,c,d,...m)=>{if(m.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${A(c.minArgs)} for ${i}(), got ${m.length}`);if(m.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${A(c.maxArgs)} for ${i}(), got ${m.length}`);return new Promise((x,$)=>{const w=ze.bind(null,{resolve:x,reject:$});m.push(w),d.sendMessage(...m)})},Qe={devtools:{network:{onRequestFinished:j(V)}},runtime:{onMessage:j(J),onMessageExternal:j(J),sendMessage:ye.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:ye.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},H={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":H},services:{"*":H},websites:{"*":H}},k(o,Qe,a)};t.exports=s(chrome)}else t.exports=globalThis.browser})});let p;(function(e){e[e.InjectConsoleCommand=0]="InjectConsoleCommand",e[e.Get2dJson=1]="Get2dJson",e[e.Get3dJson=2]="Get3dJson",e[e.GetJson=3]="GetJson",e[e.SavePlanJson=4]="SavePlanJson",e[e.OpenOptionsPage=5]="OpenOptionsPage",e[e.OpenInNewTab=6]="OpenInNewTab",e[e.OpenInCurrentTab=7]="OpenInCurrentTab",e[e.GetCurrentUrl=8]="GetCurrentUrl"})(p||(p={}));const Ce={debugClear:()=>__debugApi__.clear(),get2DJson:(...e)=>__debugApi__.get2DJson(),get3DJson:(...e)=>__debugApi__.get3DJson(),set2DJson:(...e)=>__debugApi__.set2DJson(...e),set2DJsonByURL:(...e)=>__debugApi__.set2DJsonByUrl(...e),getPlanImages:(...e)=>__debugApi__.getPlanImages(),renderPlanImages:()=>__debugApi__.renderPlanImages(),showCornice:()=>__debugApi__.drawCorniceRuns(),showPelmet:()=>__debugApi__.drawPelmetRuns(),showPlinth:()=>__debugApi__.drawPlinthRuns(),drawCollisionPolygons:()=>__debugApi__.drawCollisionPolygons(),drawCeilingOuterShapes:()=>__debugApi__.drawCeilingOuterShapes(),drawFloorOuterShapes:()=>__debugApi__.drawFloorOuterShapes(),drawOverlapPolygons:()=>__debugApi__.drawOverlapPolygons(),drawCutoutPositions:()=>__debugApi__.drawCutoutPositions(),tourRegeneratePath:()=>__debugApi__.navigation.regeneratePath(),drawTourPath:()=>__debugApi__.navigation.drawPath(),drawTourEdges:()=>__debugApi__.navigation.drawEdges(),drawTourNodes:()=>__debugApi__.navigation.drawNodes(),drawTourPrunedNodes:()=>__debugApi__.navigation.drawPrunedNodes(),drawTourWidgetBounds:()=>__debugApi__.navigation.drawWidgetBounds()},Q=new Map(Object.entries(Ce));class U{constructor(r=null){this.queryOptions={active:!0,lastFocusedWindow:!0},this.errorMessage=r??"Error"}async handle(r,t){this.currentTab=await chrome.tabs.query(this.queryOptions),this.currentTabId=this.currentTab[0].id}async execute(r,t){t()}}class L extends U{constructor(r=null){super(r)}async handle(r,t){this.callback=Q.get(r.functionName),await this.execute(r,t)}async execute(r,t){try{if(await super.handle(r,t),this.result=await chrome.scripting.executeScript({target:{tabId:this.currentTabId},world:chrome.scripting.ExecutionWorld.MAIN,args:r.arguments,func:this.callback}),!this.result)throw t(this.errorMessage),new Error(this.errorMessage);t(this.result[0].result)}catch(n){console.error(n)}}}class Se extends L{constructor(r){super(r)}async handle(r,t){super.handle(r,t)}}class Y extends L{constructor(r=null){super(r)}async handle(r,t){super.handle(r,t)}}const X=async(e,r,t)=>{const n=t.match(/(\.project[0-9])/)?.[0]||"",s=`https://feeder${n}.wrenkitchens.com/plan/save-plan-json`,o={accept:"application/json, text/plain, */*","accept-language":"en-GB,en-US;q=0.9,en;q=0.8","content-type":"application/x-www-form-urlencoded"},a=Oe(r),l=JSON.stringify(e),b=`filename=${a}&planJson=${encodeURIComponent(l)}`;return(await fetch(s,{headers:o,method:"POST",body:b})).ok?`https://feeder${n}.wrenkitchens.com/plan/read-plan-json/${a}`:"Failed to save JSON"},Ye=e=>e?.startsWith("https://feeder")&&e?.endsWith(".json"),Xe=async e=>await fetch(e),Oe=e=>{const r=new Date,t=r.getFullYear(),n=r.getMonth()+1,s=r.getDate(),o=r.getHours(),a=r.getMinutes(),l=r.getSeconds();return`${e}-${t}-${n}-${s}-${o}-${a}-${l}.json`};class _e extends L{constructor(r=null){super(r)}async handle(r,t){await super.handle(r,t);const n=this.currentTab[0]?.url,s=this.result[0]?.result?.plan?.planId,o=this.result[0]?.result,a=await X(o,s,n);t(a)}}const ee="%[a-f0-9]{2}",re=new RegExp("("+ee+")|([^%]+?)","gi"),te=new RegExp("("+ee+")+","gi");function T(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;const t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],T(t),T(n))}function Ie(e){try{return decodeURIComponent(e)}catch{let r=e.match(re)||[];for(let t=1;t<r.length;t++)e=T(r,t).join(""),r=e.match(re)||[];return e}}function ke(e){const r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"};let t=te.exec(e);for(;t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{const s=Ie(t[0]);s!==t[0]&&(r[t[0]]=s)}t=te.exec(e)}r["%C2"]="\uFFFD";const n=Object.keys(r);for(const s of n)e=e.replace(new RegExp(s,"g"),r[s]);return e}function Ee(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return ke(e)}}function ne(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];const t=e.indexOf(r);return t===-1?[]:[e.slice(0,t),e.slice(t+r.length)]}function W(e,r){const t={};if(Array.isArray(r))for(const n of r){const s=Object.getOwnPropertyDescriptor(e,n);s?.enumerable&&Object.defineProperty(t,n,s)}else for(const n of Reflect.ownKeys(e)){const s=Object.getOwnPropertyDescriptor(e,n);if(s.enumerable){const o=e[n];r(n,o,e)&&Object.defineProperty(t,n,s)}}return t}function er(e,r){if(Array.isArray(r)){const t=new Set(r);return W(e,n=>!t.has(n))}return W(e,(t,n,s)=>!r(t,n,s))}const ve=e=>e==null,Me=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),R=Symbol("encodeFragmentIdentifier");function je(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{const s=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[f(r,e),"[",s,"]"].join("")]:[...t,[f(r,e),"[",f(s,e),"]=",f(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[f(r,e),"[]"].join("")]:[...t,[f(r,e),"[]=",f(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[f(r,e),":list="].join("")]:[...t,[f(r,e),":list=",f(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:(s=s===null?"":s,n.length===0?[[f(t,e),r,f(s,e)].join("")]:[[n,f(s,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,f(r,e)]:[...t,[f(r,e),"=",f(n,e)].join("")]}}function Fe(e){let r;switch(e.arrayFormat){case"index":return(t,n,s)=>{if(r=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),!r){s[t]=n;return}s[t]===void 0&&(s[t]={}),s[t][r[1]]=n};case"bracket":return(t,n,s)=>{if(r=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),!r){s[t]=n;return}if(s[t]===void 0){s[t]=[n];return}s[t]=[...s[t],n]};case"colon-list-separator":return(t,n,s)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){s[t]=n;return}if(s[t]===void 0){s[t]=[n];return}s[t]=[...s[t],n]};case"comma":case"separator":return(t,n,s)=>{const o=typeof n=="string"&&n.includes(e.arrayFormatSeparator),a=typeof n=="string"&&!o&&S(n,e).includes(e.arrayFormatSeparator);n=a?S(n,e):n;const l=o||a?n.split(e.arrayFormatSeparator).map(b=>S(b,e)):n===null?n:S(n,e);s[t]=l};case"bracket-separator":return(t,n,s)=>{const o=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!o){s[t]=n&&S(n,e);return}const a=n===null?[]:n.split(e.arrayFormatSeparator).map(l=>S(l,e));if(s[t]===void 0){s[t]=a;return}s[t]=[...s[t],...a]};default:return(t,n,s)=>{if(s[t]===void 0){s[t]=n;return}s[t]=[...[s[t]].flat(),n]}}}function se(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function f(e,r){return r.encode?r.strict?Me(e):encodeURIComponent(e):e}function S(e,r){return r.decode?Ee(e):e}function ae(e){return Array.isArray(e)?e.sort():typeof e=="object"?ae(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function oe(e){const r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Ne(e){let r="";const t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function ie(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function ce(e){e=oe(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function le(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...r},se(r.arrayFormatSeparator);const t=Fe(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(const s of e.split("&")){if(s==="")continue;const o=r.decode?s.replace(/\+/g," "):s;let[a,l]=ne(o,"=");a===void 0&&(a=o),l=l===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?l:S(l,r),t(S(a,r),l,n)}for(const[s,o]of Object.entries(n))if(typeof o=="object"&&o!==null)for(const[a,l]of Object.entries(o))o[a]=ie(l,r);else n[s]=ie(o,r);return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((s,o)=>{const a=n[o];return Boolean(a)&&typeof a=="object"&&!Array.isArray(a)?s[o]=ae(a):s[o]=a,s},Object.create(null))}function ge(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},se(r.arrayFormatSeparator);const t=a=>r.skipNull&&ve(e[a])||r.skipEmptyString&&e[a]==="",n=je(r),s={};for(const[a,l]of Object.entries(e))t(a)||(s[a]=l);const o=Object.keys(s);return r.sort!==!1&&o.sort(r.sort),o.map(a=>{const l=e[a];return l===void 0?"":l===null?f(a,r):Array.isArray(l)?l.length===0&&r.arrayFormat==="bracket-separator"?f(a,r)+"[]":l.reduce(n(a),[]).join("&"):f(a,r)+"="+f(l,r)}).filter(a=>a.length>0).join("&")}function Ue(e,r){r={decode:!0,...r};let[t,n]=ne(e,"#");return t===void 0&&(t=e),{url:t?.split("?")?.[0]??"",query:le(ce(e),r),...r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:S(n,r)}:{}}}function De(e,r){r={encode:!0,strict:!0,[R]:!0,...r};const t=oe(e.url).split("?")[0]||"",n=ce(e.url),s={...le(n,{sort:!1}),...e.query};let o=ge(s,r);o&&(o=`?${o}`);let a=Ne(e.url);if(e.fragmentIdentifier){const l=new URL(t);l.hash=e.fragmentIdentifier,a=r[R]?l.hash:`#${e.fragmentIdentifier}`}return`${t}${o}${a}`}function Je(e,r,t){t={parseFragmentIdentifier:!0,[R]:!1,...t};const{url:n,query:s,fragmentIdentifier:o}=Ue(e,t);return De({url:n,query:W(s,r),fragmentIdentifier:o},t)}function rr(e,r,t){const n=Array.isArray(r)?s=>!r.includes(s):(s,o)=>!r(s,o);return Je(e,n,t)}let de;(function(e){e.JsonEditor="JSONEditor",e.SwitchAndSave="SwitchAndSave",e.ProductQuery="ProductQuery"})(de||(de={}));let me;(function(e){e.Frontals="Frontals",e.CoffeeMachines="CoffeeMachines",e.Cooking="Cooking",e.Extraction="Extraction",e.Laundry="Laundry",e.Refrigeration="Refrigeration",e.Sinks="Sinks",e["Small Domestic Appliances"]="Small Domestic Appliances",e.Dishwashers="Dishwashers"})(me||(me={}));let ue;(function(e){e.Active="Active",e.Born="Born",e.Conception="Conception",e.Gestation="Gestation",e.Semiretired="Semiretired",e.Retired="Retired"})(ue||(ue={}));let fe;(function(e){e.Any="Any",e.Wren="Wren",e.Zanussi="Zanussi",e.AEG="AEG",e.Neff="Neff",e.Miele="Miele",e.Matrix="Matrix",e.Hotpoint="Hotpoint",e.Indesit="Indesit",e.Whirlpool="Whirlpool",e.Smeg="Smeg",e.Rangemaster="Rangemaster",e.Leisure="Leisure",e.Samsung="Samsung",e.LG="LG",e.Blanco="Blanco"})(fe||(fe={}));let Ae;(function(e){e.BuiltUnderDoubleOvens="Built Under Double Ovens",e.CompactOvens="Compact Ovens",e.DoubleOvens="Double Ovens",e.SingleOvens="Single Ovens",e.CombinationWallOvens="Combination Wall Ovens",e.DoubleWallOvens="Double Wall Ovens",e.SingleWallOvens="Single Wall Ovens"})(Ae||(Ae={}));let he;(function(e){e.UK="com",e.US="us"})(he||(he={}));let v;(function(e){e.Units="units",e.Products="products",e.Ranges="ranges"})(v||(v={}));let G;(function(e){e.live="live",e.project0="project0",e.project1="project1",e.project2="project2",e.project3="project3",e.project4="project4",e.project5="project5",e.project6="project6",e.project7="project7",e.project8="project8",e.training="training"})(G||(G={}));async function Pe(e,r,t){try{if((await fetch(e)).status===200)t?await chrome.tabs.create({url:e}):await chrome.tabs.update(r,{url:e});else throw new Error(`Failed to fetch URL: ${e}`)}catch(n){throw n}}async function tr(){return await navigator.clipboard.readText()}async function nr(e){if(!e){console.log("Missing string to write to clipboard");return}await navigator.clipboard.writeText(e)}const sr={toHtml:e=>{const r=s=>s.replace(/&/g,"&amp;").replace(/\\"/g,"&bsol;&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=(s,o,a,l,b)=>{const u={indent:o,key:a,value:l,end:b},A=u.key&&u.key.replace(/"([^"]+)":\s*/,'<span class="json-key">"$1"</span>: '),M=u.value,I=["true","false"].includes(u.value),O=/^"/.test(u.value)?'<span class="json-string">':I?'<span class="json-boolean">':'<span class="json-value">',k=u.indent||"",j=u.key?A:"",V=u.value?O+u.value+"</span>":"",J=u.end||"";return k+j+V+J},n=/^( *)("[^"]+": )?("[^"]*"|[\w.+-]*)?([{}[\],]*)?$/mg;return r(JSON.stringify(e,null,3)).replace(n,t)}};async function ar(e,r){const t={functionName:e,type:p.InjectConsoleCommand,arguments:r};let n=await chrome.runtime.sendMessage(t);if(!n)throw new Error("injectDebugCommand: Failed get result");return n}async function or(){const e={functionName:"get2DJson",type:p.Get2dJson,arguments:null};let r=await chrome.runtime.sendMessage(e);if(!r)throw new Error("get2DJson: Failed to get 2D JSON");return r}async function ir(){const e={functionName:"get3DJson",type:p.Get3dJson,arguments:null},r=await chrome.runtime.sendMessage(e);if(!r)throw new Error("get3DJson: Failed to get 3D JSON");return r}async function cr(e){let r=[e];const t=e?.startsWith("https://feeder")?"set2DJsonByURL":"set2DJson";r[0]=e;const n={functionName:t,type:p.InjectConsoleCommand,arguments:r};await chrome.runtime.sendMessage(n)}function lr(e){return e===null?"":(e/100).toFixed(2)}function gr(e){return e.replace(/\s/g,"")}function dr(e,r,t){const n=r-t,s=r+t;return e>=n&&e<=s}async function mr(e){const r={functionName:"SavePlanJson",type:p.SavePlanJson,arguments:e};let t=await chrome.runtime.sendMessage(r);if(t)return t;throw new Error("save2dJsonToFeeder: Failed to save 2D JSON")}const ur=async(e,r,t,n,s)=>{const o=`https://feeder.${r===G.live?"":`${r}.`}wrenkitchens.${t}/${e}`;let a={};e===v.Products&&(a.campaignPhaseId=s);const l=(n||"").includes("."),b=/^\d+$/.test(n||"");l?e===v.Products?a.productCode=n:a.unitDefinitionId=n:b&&(e===v.Products?a.productId=n:a.unitDefinitionId=n);const u=await fetch(`${o}?${ge(a)}`);try{const A=await u.json();if(A)return console.log(A),A}catch(A){return A}};class be extends U{constructor(r=null,t){super(r),this.openInNewTab=t}async handle(r,t){try{const n=r.arguments[0],s=this.currentTabId;await Pe(n,s,this.openInNewTab)}catch(n){t(n.message)}}}class Le extends U{constructor(r=null){super(r)}async handle(r,t){chrome.runtime.openOptionsPage(),t()}}class Te extends U{constructor(r=null){super(r)}async handle(r,t){await super.handle(r,t);const n=this.currentTab[0]?.url;t(n)}}const We=e=>{switch(e.type){case p.InjectConsoleCommand:return new Se(null);case p.Get2dJson:return new Y("Missing 2D JSON Result");case p.Get3dJson:return new Y("Missing 3D JSON Result");case p.SavePlanJson:return new _e(null);case p.OpenInCurrentTab:return new be(null,!1);case p.OpenInNewTab:return new be(null,!0);case p.OpenOptionsPage:return new Le(null);case p.GetCurrentUrl:return new Te("Failed to get current tab URL")}};var xe=_("3d6g0");function Re(e){let r=e.length;for(var t=e.length-1;t>=0;t--){let n=e.charCodeAt(t);n>127&&n<=2047?r++:n>2047&&n<=65535&&(r+=2),n>=56320&&n<=57343&&t--}return r}var Ge=async(e,r,t)=>{let n="";e:if(e.area!=="managed"){if(!chrome?.storage?.[e.area].getBytesInUse)break e;let s=e.primaryClient,o=s.QUOTA_BYTES||102400,a=Re(t),[l,b]=await Promise.all([s.getBytesInUse(),s.getBytesInUse(r)]),u=l+a-b,A=u/o;if(A>.8&&(n=`Storage quota is almost full. ${u}/${o}, ${A*100}%`),A>1)throw new Error("ABORTED - New value would exceed storage quota.")}return n},pe=typeof window<"u",Be=class{#n;#s=!1;#e;get primaryClient(){return this.#e}#r;get secondaryClient(){return this.#r}#a;get area(){return this.#a}get hasWebAPI(){return pe}#t=new Map;#o;get copiedKeySet(){return this.#o}isCopied=e=>this.hasWebAPI&&(this.allCopied||this.copiedKeySet.has(e));#i=!1;get allCopied(){return this.#i}#c=!1;get hasExtensionApi(){return this.#c}isWatchSupported=()=>this.hasExtensionApi;constructor({area:e="sync",unlimited:r=!1,allCopied:t=!1,copiedKeyList:n=[]}={}){this.setCopiedKeySet(n),this.#a=e,this.#s=r,this.#i=t,Z(xe).storage&&(this.#n=Z(xe).storage,this.#e=this.#n[this.area],this.#c=!0),pe&&(this.#r=window.localStorage)}setCopiedKeySet(e){this.#o=new Set(e)}getAll=()=>this.#e?.get();copy=async e=>{let r=e===void 0;if(!r&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let t=this.allCopied?await this.getAll():await this.#e.get(r?[...this.copiedKeySet]:[e]),n=!1;for(let s in t){let o=t[s],a=this.#r?.getItem(s);this.#r?.setItem(s,o),n||=o!==a}return n};rawGet=async e=>this.hasExtensionApi?(await this.#e.get(e))[e]:this.isCopied(e)?this.#r?.getItem(e):null;rawSet=async(e,r)=>{if(this.isCopied(e)&&this.#r?.setItem(e,r),this.hasExtensionApi){let t=this.#s?await Ge(this,e,r):"";return await this.#e.set({[e]:r}),t}return null};clear=async(e=!1)=>{e&&this.#r?.clear(),await this.#e.clear()};remove=async e=>{this.isCopied(e)&&this.#r?.removeItem(e),this.hasExtensionApi&&await this.#e.remove(e)};watch=e=>{let r=this.isWatchSupported();return r&&this.#l(e),r};#l=e=>{Object.entries(e).forEach(([r,t])=>{let n=this.#t.get(r)?.callbackSet||new Set;if(n.add(t),n.size>1)return;let s=(o,a)=>{if(a!==this.area)return;let l=new Set(Object.keys(e)),b=Object.keys(o).filter(u=>l.has(u));b.length!==0&&Promise.all(b.map(async u=>{let A=this.#t.get(u),[M,I]=await Promise.all([this.parseValue(o[u].newValue),this.parseValue(o[u].oldValue)]);A?.callbackSet?.forEach(O=>O({newValue:M,oldValue:I},a))}))};this.#n.onChanged.addListener(s),this.#t.set(r,{callbackSet:n,listener:s})})};unwatch=e=>{let r=this.isWatchSupported();return r&&this.#g(e),r};#g(e){Object.entries(e).filter(([r])=>this.#t.has(r)).forEach(([r,t])=>{let n=this.#t.get(r);n.callbackSet.delete(t),n.callbackSet.size===0&&(this.#t.delete(r),this.#n.onChanged.removeListener(n.listener))})}unwatchAll=()=>this.#d();#d(){this.#t.forEach(({listener:e})=>this.#n.onChanged.removeListener(e)),this.#t.clear()}},B=class extends Be{get=async e=>{let r=await this.rawGet(e);return this.parseValue(r)};set=async(e,r)=>{let t=JSON.stringify(r);return this.rawSet(e,t)};parseValue=async e=>{try{if(e!==void 0)return JSON.parse(e)}catch(r){console.error(r)}}};let D;(function(e){e[e.WriteToClipboard=0]="WriteToClipboard",e[e.AutofillAccount=1]="AutofillAccount"})(D||(D={}));const K=new B,Ke=new B;async function $e(){chrome.contextMenus.create({id:"accountContextMenu",title:"Frontend Accounts",contexts:["all"],parentId:"parentContextMenu",documentUrlPatterns:["https://*.wrenkitchens.com/accounts/account/new"]}),chrome.contextMenus.create({id:"usAccountContextMenu",title:"US Frontend Accounts",contexts:["all"],parentId:"parentContextMenu",documentUrlPatterns:["https://*.wrenkitchens.us/accounts/account/new"]}),await Ve()}async function Ve(){const e=await K.get("frontendAccounts"),r=await Ke.get("frontendAccountsUS");e?e.forEach(t=>{chrome.contextMenus.create({id:"uk-"+t.id.toString(),title:t.emailAddress,contexts:["all"],parentId:"accountContextMenu"})}):console.error("Failed to find UK accounts"),r?r.forEach(t=>{chrome.contextMenus.create({id:"us-"+t.id.toString(),title:t.emailAddress,contexts:["all"],parentId:"usAccountContextMenu"})}):console.error("Failed to find US accounts")}chrome.contextMenus.onClicked.addListener(async(e,r)=>{if(e.menuItemId==="parentContextMenu")return;const t=["accountContextMenu","usAccountContextMenu"].includes(e.parentMenuItemId)?e.parentMenuItemId:null;if(t){const n=t==="accountContextMenu"?"frontendAccounts":"frontendAccountsUS",s=await K.get(n);if(!s){console.error("Failed to find accounts");return}const o=s.find(a=>(t==="accountContextMenu"?"uk-":"us-")+a.id.toString()===e.menuItemId);if(o){const a=t==="accountContextMenu"?"UK":"US",l={type:D.AutofillAccount,functionName:null,arguments:[a,o]};await chrome.tabs.sendMessage(r.id,l)}else console.error("Could not find account with id: "+e.menuItemId)}});function we(){chrome.contextMenus.remove("accountContextMenu",async()=>{chrome.contextMenus.remove("usAccountContextMenu",async()=>{await $e()})})}K.watch({frontendAccounts:()=>{we()},frontendAccountsUS:()=>{we()}});const He=async(e,r,t=null)=>await chrome.scripting.executeScript({target:{tabId:e.id},world:chrome.scripting.ExecutionWorld.MAIN,args:t,func:Q.get(r)});async function qe(){chrome.contextMenus.create({id:"save2dJsonFeeder",title:"Save 2D JSON As Feeder",contexts:["all"],parentId:"parentContextMenu",documentUrlPatterns:["https://planner2d.wrenkitchens.com/*","https://planner2d.project0.wrenkitchens.com/*","https://planner2d.project1.wrenkitchens.com/*","https://planner2d.project2.wrenkitchens.com/*","https://planner2d.project3.wrenkitchens.com/*","https://planner2d.project4.wrenkitchens.com/*","https://planner2d.project5.wrenkitchens.com/*","https://planner2d.project6.wrenkitchens.com/*","https://planner2d.project7.wrenkitchens.com/*","https://planner2d.project8.wrenkitchens.com/*"]})}chrome.contextMenus.onClicked.addListener(async(e,r)=>{if(e.menuItemId==="save2dJsonFeeder"){const n=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0],s=n.url,o=await He(n,"get2DJson"),a=o[0].result.plan.planId,l=await X(o[0].result,a,s),b={type:D.WriteToClipboard,arguments:[l],functionName:null};await chrome.tabs.sendMessage(n.id,b)}});const fr=new B;async function Ze(){await chrome.contextMenus.create({id:"parentContextMenu",title:"QA ToolKit",contexts:["all"]}),await $e(),await qe()}console.log("background script loaded"),chrome.runtime.onMessage.addListener((e,r,t)=>(We(e).handle(e,t),!0)),chrome.runtime.onInstalled.addListener(()=>{Ze()})})();
